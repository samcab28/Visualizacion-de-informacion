<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hierarchical Data Visualization with D3.js</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
    <div id="demo10"></div>
    <script>
        var width = 1000;
        var height = 1000;
        var radius = Math.min(width, height) / 2;

        var svg = d3.select("#demo10")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        var input = {
            "name": "Costa Rica",
            "children": [
                {
                    "name": "San José",
                    "children": [
                        { "name": "San José", "size": 351958 },
                        { "name": "Escazú", "size": 71202 },
                        { "name": "Desamparados", "size": 249367 },
                        { "name": "Puriscal", "size": 38593 },
                        { "name": "Tarrazú", "size": 18787 },
                        { "name": "Aserrí", "size": 64480 },
                        { "name": "Mora", "size": 30759 },
                        { "name": "Goicoechea", "size": 140764 },
                        { "name": "Santa Ana", "size": 61853 },
                        { "name": "Alajuelita", "size": 97158 },
                        { "name": "Vázquez de Coronado", "size": 72932 },
                        { "name": "Acosta", "size": 22257 },
                        { "name": "Tibás", "size": 86065 },
                        { "name": "Moravia", "size": 63259 },
                        { "name": "Montes de Oca", "size": 62844 },
                        { "name": "Turrubares", "size": 7031 },
                        { "name": "Dota", "size": 8041 },
                        { "name": "Curridabat", "size": 80677 },
                        { "name": "Pérez Zeledón", "size": 143282 },
                        { "name": "León Cortés", "size": 13990 }
                    ]
                },
                { "name": "Alajuela", "size": 1039127 },
                { "name": "Cartago", "size": 547691 },
                { "name": "Heredia", "size": 539598 },
                { "name": "Guanacaste", "size": 404774 },
                { "name": "Puntarenas", "size": 510566 },
                { "name": "Limón", "size": 469797 }
            ]
        };

        var root = d3.hierarchy(input)
            .sum(function(d) { return d.size; })
            .sort(function(a, b) { return b.value - a.value; });

        var partition = d3.partition()
            .size([2 * Math.PI, radius]);

        partition(root);

        var arc = d3.arc()
            .startAngle(function(d) { return d.x0; })
            .endAngle(function(d) { return d.x1; })
            .innerRadius(function(d) { return radius - (d.depth * radius / root.height); })
            .outerRadius(function(d) { return radius - ((d.depth - 1) * radius / root.height); });

        svg.selectAll("path")
            .data(root.descendants())
            .enter().append("path")
            .attr("display", function(d) { return d.depth ? null : "none"; }) // Hide the root node
            .attr("d", arc)
            .style("stroke", "#fff")
            .style("fill", function(d) { 
                switch(d.depth) {
                    case 1: return "pink"; // Provincias
                    case 2: return "red";  // Cantones
                    default: return "green"; // Default color
                }
            })
            .append("title")
            .text(function(d) { return d.data.name + "\n" + d.value; });

        svg.selectAll("text")
            .data(root.descendants())
            .enter().append("text")
            .attr("transform", function(d) { 
                return "translate(" + arc.centroid(d) + ")rotate(" + computeTextRotation(d) + ")"; 
            })
            .attr("dx", "-20") // radius margin
            .attr("dy", ".5em")
            .text(function(d) { return d.parent ? d.data.name : ""; });

        function computeTextRotation(d) {
            var angle = (d.x0 + d.x1) / Math.PI * 90;
            return (angle < 180) ? angle - 90 : angle + 90;
        }
    </script>
</body>
</html>
