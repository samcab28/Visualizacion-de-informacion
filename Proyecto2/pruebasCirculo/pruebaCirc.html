<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hierarchical Data Visualization with D3.js</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
    <div id="demo10"></div>
    <script>
        var width =3500;
        var height = 3500;
        var radius = Math.min(width, height) / 2;

        var svg = d3.select("#demo10")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

            var input = {
    "name": "Costa Rica",
    "children": [
        {
            "name": "San José",
            "children": [
                { "name": "San José", "size": 351958 },
                { "name": "Escazú", "size": 71202 },
                { "name": "Desamparados", "size": 249367 },
                { "name": "Puriscal", "size": 38593 },
                { "name": "Tarrazú", "size": 18787 },
                { "name": "Aserrí", "size": 64480 },
                { "name": "Mora", "size": 30759 },
                { "name": "Goicoechea", "size": 140764 },
                { "name": "Santa Ana", "size": 61853 },
                { "name": "Alajuelita", "size": 97158 },
                { "name": "Vázquez de Coronado", "size": 72932 },
                { "name": "Acosta", "size": 22257 },
                { "name": "Tibás", "size": 86065 },
                { "name": "Moravia", "size": 63259 },
                { "name": "Montes de Oca", "size": 62844 },
                { "name": "Turrubares", "size": 7031 },
                { "name": "Dota", "size": 8041 },
                { "name": "Curridabat", "size": 80677 },
                { "name": "Pérez Zeledón", "size": 143282 },
                { "name": "León Cortés", "size": 13990 }
            ]
        },
        {
            "name": "Alajuela",
            "children": [
                { "name": "Alajuela", "size": 321872 },
                { "name": "San Ramón", "size": 95794 },
                { "name": "Grecia", "size": 79672 },
                { "name": "San Mateo", "size": 7276 },
                { "name": "Atenas", "size": 29880 },
                { "name": "Naranjo", "size": 49764 },
                { "name": "Palmares", "size": 41805 },
                { "name": "Poás", "size": 34926 },
                { "name": "Orotina", "size": 24448 },
                { "name": "San Carlos", "size": 206115 },
                { "name": "Zarcero", "size": 14629 },
                { "name": "Sarchí", "size": 22596 },
                { "name": "Upala", "size": 55466 },
                { "name": "Los Chiles", "size": 35188 },
                { "name": "Guatuso", "size": 19696 },
                { "name": "Río Cuarto", "size": 0 }
            ]
        },
        {
            "name": "Cartago",
            "children": [
                { "name": "Cartago", "size": 166204 },
                { "name": "Paraíso", "size": 63796 },
                { "name": "La Unión", "size": 114615 },
                { "name": "Jiménez", "size": 16361 },
                { "name": "Turrialba", "size": 73546 },
                { "name": "Alvarado", "size": 15615 },
                { "name": "Oreamuno", "size": 50595 },
                { "name": "El Guarco", "size": 46959 }
            ]
        },
        {
            "name": "Heredia",
            "children": [
                { "name": "Heredia", "size": 146020 },
                { "name": "Barva", "size": 48190 },
                { "name": "Santo Domingo", "size": 49835 },
                { "name": "Santa Bárbara", "size": 43878 },
                { "name": "San Rafael", "size": 56560 },
                { "name": "San Isidro", "size": 23655 },
                { "name": "Belén", "size": 26853 },
                { "name": "Flores", "size": 25401 },
                { "name": "San Pablo", "size": 31519 },
                { "name": "Sarapiquí", "size": 87687 }
            ]
        },
        {
            "name": "Guanacaste",
            "children": [
                { "name": "Liberia", "size": 79610 },
                { "name": "Nicoya", "size": 57624 },
                { "name": "Santa Cruz", "size": 71284 },
                { "name": "Bagaces", "size": 24847 },
                { "name": "Carrillo", "size": 47756 },
                { "name": "Cañas", "size": 33393 },
                { "name": "Abangares", "size": 20282 },
                { "name": "Tilarán", "size": 21984 },
                { "name": "Nandayure", "size": 11838 },
                { "name": "La Cruz", "size": 28071 },
                { "name": "Hojancha", "size": 8085 }
            ]
        },
        {
            "name": "Puntarenas",
            "children": [
                { "name": "Puntarenas", "size": 143875 },
                { "name": "Esparza", "size": 39244 },
                { "name": "Buenos Aires", "size": 54782 },
                { "name": "Montes de Oro", "size": 14587 },
                { "name": "Osa", "size": 31383 },
                { "name": "Quepos", "size": 34020 },
                { "name": "Golfito", "size": 46523 },
                { "name": "Coto Brus", "size": 44280 },
                { "name": "Parrita", "size": 20984 },
                { "name": "Corredores", "size": 53484 },
                { "name": "Garabito", "size": 27404 }
            ]
        },
        {
            "name": "Limón",
            "children": [
                { "name": "Limón", "size": 100236 },
                { "name": "Pococí", "size": 154674 },
                { "name": "Siquirres", "size": 65673 },
                { "name": "Talamanca", "size": 44802 },
                { "name": "Matina", "size": 47391 },
                { "name": "Guácimo", "size": 57021 }
            ]
        }
    ]
}

        var root = d3.hierarchy(input)
            .sum(function(d) { return d.size; })
            .sort(function(a, b) { return b.value - a.value; });

        var partition = d3.partition()
            .size([2 * Math.PI, radius]);

        partition(root);

        var colorScale = d3.scaleOrdinal()
            .domain(["San José", "Guanacaste", "Puntarenas", "Alajuela", "Cartago", "Limón", "Heredia"])
            .range(["blue", "green", "orange", "red", "purple", "yellow", "gray"]);

        var arc = d3.arc()
            .startAngle(function(d) { return d.x0; })
            .endAngle(function(d) { return d.x1; })
            .innerRadius(function(d) { return radius - (d.depth * radius / root.height); })
            .outerRadius(function(d) { return radius - ((d.depth - 1) * radius / root.height); });

        svg.selectAll("path")
            .data(root.descendants())
            .enter().append("path")
            .attr("display", function(d) { return d.depth ? null : "none"; }) // Hide the root node
            .attr("d", arc)
            .style("stroke", "#fff")
            .style("fill", function(d) { 
                return d.depth === 1 ? colorScale(d.data.name) : d.parent ? colorScale(d.parent.data.name) : null;
            })
            .append("title")
            .text(function(d) { return d.data.name + "\n" + d.value; });

        svg.selectAll("text")
            .data(root.descendants())
            .enter().append("text")
            .attr("transform", function(d) { 
                return "translate(" + arc.centroid(d) + ")rotate(" + computeTextRotation(d) + ")"; 
            })
            .attr("dx", "-20") // radius margin
            .attr("dy", ".5em")
            .style("font-size", function(d) {
                var fontSize = Math.min((2 * radius * Math.PI) / root.height, 30); // Limit font size to 24px
                return fontSize + "px";
            })
            .text(function(d) { return d.parent ? d.data.name : ""; });


        function computeTextRotation(d) {
            var angle = (d.x0 + d.x1) / Math.PI * 90;
            return (angle < 180) ? angle - 90 : angle + 90;
        }
    </script>
</body>
</html>
